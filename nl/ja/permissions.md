---

copyright:

  years: 2015, 2017, 2018

lastupdated: "2019-01-15"

---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}
{:codeblock: .codeblock}
{:pre: .pre}
{:screen: .screen}
{:tip: .tip}

# 許可
{: #permissions}

ユーザーが {{site.data.keyword.cfee_full}} (CFEE) サービスを作成して作業を開始するには、その前に、CFEE インスタンスが作成されるアカウントの管理者に、ユーザーの許可を正しく設定してもらう必要があります。 

## 許可の概要
{: #perm-summary}

以下に、CFEE インスタンスでの各種タスクの実行に必要な最小限の [IAM](https://cloud.ibm.com/iam#/users) と [Cloud Foundry 役割の割り当て](https://cloud.ibm.com/account/cloud-foundry)の要約を示します。 残りのセクションでは、これらの許可の詳細を説明します。

|  **タスク** &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|  **IAM アクセスの役割** &nbsp; &nbsp; &nbsp; |**Cloud Foundry の役割** &nbsp; &nbsp; &nbsp; |
|----------------------------------------|-------------------|-------------------|
|CFEE の作成 |  <ul><li>CFEE が作成されるリソース・グループのビューアーの役割。</li> <li>CFEE サービスのエディター役割。</li> <li>Kubernetes サービスの管理者役割。</li> <li>Cloud Object Storage サービスのエディター役割。</li> </ul> | <ul><li>パブリック組織のユーザー役割。</li> <li>そのパブリック組織のスペースの開発者役割。 </li></ul>|
|CFEE バージョンの更新 |  <ul><li>CFEE リソース・グループのビューアー役割。</li> <li>CFEE サービスのエディター役割。</li></li> <li>Kubernetes サービスのオペレーター役割。</li> <li>Cloud Object Storage サービスのエディター役割。</li> </ul> | <ul><li>パブリック組織のユーザー役割。</li> <li>そのパブリック組織のスペースの開発者役割。 </li></ul>|
|CFEE 容量のスケーリング (セルの追加/削除)|  <ul><li>CFEE インスタンス・リソース・グループのビューアー役割。</li> <li>CFEE インスタンスの管理者役割。</li> <li>Kubernetes サービスのオペレーター役割。</li> <li>Cloud Object Storage サービスのエディター役割。</li> </ul> | |
|CFEE のモニター |  <ul><li>CFEE インスタンス・リソース・グループのビューアー役割。</li> <li>CFEE インスタンスのエディター役割。</li></ul> |  |
|CFEE リソース使用量の表示 |  <ul><li>CFEE インスタンス・リソース・グループのビューアー役割。</li> <li>CFEE インスタンスのビューアー役割。</li></ul> |  |
|CFEE 監査の有効化| <ul><li>CFEE インスタンス・リソース・グループのビューアー役割。</li> <li>CFEE インスタンスのエディター役割。</li></ul> | <ul><li>Activity Tracker サービス・インスタンスがデプロイされるパブリック Cloud Foundry スペースの監査員役割。</li></ul>  |
|CFEE 監査イベントの表示| <ul><li>CFEE インスタンス・リソース・グループのビューアー役割。</li> <li>CFEE インスタンスのエディター役割。</li></ul> | <ul><li>Activity Tracker サービス・インスタンスがデプロイされるパブリック Cloud Foundry スペースの監査員役割。</li></ul>  |
|CFEE ログ・パーシスタンスの有効化| <ul><li>CFEE インスタンス・リソース・グループのビューアー役割。</li> <li>CFEE インスタンスのエディター役割。</li></ul> |<ul><li>Log Analysis サービス・インスタンスがデプロイされるパブリック Cloud Foundry スペースの監査員役割。</li></ul>  |
|CFEE の永続ログの表示| <ul><li>CFEE インスタンス・リソース・グループのビューアー役割。</li> <li>CFEE インスタンスのエディター役割。</li></ul> | <ul><li>Log Analysis サービス・インスタンスがデプロイされるパブリック Cloud Foundry スペースの監査員役割。</li></ul> |
|CFEE 組織の作成| <ul><li>CFEE インスタンス・リソース・グループのビューアー役割。</li> <li>CFEE インスタンスのエディター役割。</li></ul> |  |
|CFEE スペースの作成| <ul><li>CFEE インスタンス・リソース・グループのビューアー役割。</li> <li>CFEE インスタンスのビューアー役割。</li></ul> | <ul><li>スペースが作成される組織の管理者。</li></ul> |
|共有ドメインの管理|<ul><li>CFEE インスタンス・リソース・グループのビューアー。 </li><li>CFEE インスタンスのエディター役割。 </li></ul>|  |
|共有ドメインの表示|<ul><li>CFEE インスタンス・リソース・グループのビューアー。 </li><li>CFEE インスタンスのビューアー役割。 </li></ul>|  |
|専用ドメインの管理|<ul> <li>CFEE インスタンス・リソース・グループのビューアー。 </li><li>CFEE インスタンスのビューアー役割。 </li></ul>| <ul><li>ドメインを所有する組織の管理者役割。 </li></ul>|
|専用ドメインの表示|<ul> <li>CFEE インスタンス・リソース・グループのビューアー。 </li><li>CFEE インスタンスのビューアー役割。 </li></ul>|<ul><li>ドメインを所有する組織のビューアー役割。 </li></ul>|
|CFEE スペースの IBM Cloud サービス・インスタンスの作成/削除| <ul><li>CFEE が作成されるリソース・グループのビューアーの役割。</li> <li>CFEE インスタンスのビューアー役割。</li> <li>サービス・インスタンスが作成されるリソース・グループ、または IAM 管理対象サービスがインスタンス化されるリソース・グループのエディター。</li> </ul>| <ul><li>サービス・インスタンスが作成される (自動的に追加/別名割り当てされる) CFEE スペースの開発者役割。</li></ul> |
|CFEE スペースに対する IBM Cloud サービス・インスタンスの追加/削除 (つまり、CFEE スペースの IBM Cloud サービスに対する別名の作成/削除)| <ul><li>CFEE インスタンス・リソース・グループのビューアー役割。</li><li>CFEE インスタンスのビューアー役割。 </li><li>追加されるサービス・インスタンスに対するオペレーターのプラットフォーム役割およびリーダーのサービス役割。 </li></ul>|<ul><li>サービス・インスタンスが追加される (別名割り当てされる) CFEE スペースの開発者役割。</li></ul> |
|CFEE スペースの IBM Cloud サービス・インスタンスのバインドまたはアンバインド|<ul> <li>バインドまたはアンバインドするサービス・インスタンスのリソース・グループのエディター。</li><li>CFEE インスタンスのビューアー役割。 </li><li>バインドするサービス・インスタンスに対するオペレーターのプラットフォーム役割またはライターのサービス役割。</li></ul> | <ul><li>サービス・インスタンスがバインドされる CFEE スペースの開発者役割。</li></ul> |
|`cf` cli コマンドの発行|<ul> <li>CFEE インスタンス・リソース・グループのビューアー役割。 </li><li>CFEE インスタンスのビューアー役割。</li></ul> | <ul><li>コマンドの実行に必要な組織/スペースの Cloud Foundry 役割。</li></ul> |
{: caption="表 1. CFEE のタスクの実行に必要な許可" caption-side="top"}

## 新しい環境を作成するために必要な許可
{: #perm-creating}

CFEE サービスの新規インスタンスを作成するためには、CFEE サービス自体に対するアクセス・ポリシーだけではなく、CFEE 作成時に自動的に作成されるサポート・サービスに対するアクセス・ポリシーも、アカウント管理者によってユーザーに付与される必要があります。

ユーザーが {{site.data.keyword.cfee_full_notm}} インスタンスを作成できるためには、以下の ID およびアクセス管理 (IAM) アクセス・ポリシーが必要です。

* {{site.data.keyword.Bluemix}} アカウント内の**_デフォルト_** の**リソース・グループ**に対する_ビューアー_ (またはそれ以上) のアクセス権限。 リソース・グループでは、リソースへのアクセス制御を可能にするために、それらのリソースをカスタマイズされたグループに編成できます。 新規環境インスタンスを作成するときに、リソース・グループに関するプロンプトが出されます。 _デフォルト_ のリソース・グループに対するアクセス権限が必要なのは、常にこのリソース・グループでは Kubernetes クラスターが必要であるためです。  ユーザーは異なるリソース・グループに CFEE インスタンスをプロビジョンできますが、その場合でも Kuberetes クラスターは_デフォルト_ のリソース・グループにプロビジョンされます。  ユーザーが異なるユーザー・グループに CFEE をプロビジョンする場合、そのユーザーにはそのリソース・グループ内でビューアーのアクセス権限が必要になります。

* **{{site.data.keyword.cfee_full_notm}} サービス**のリソースに対する_管理者_ または_エディター_ の役割。 環境が割り当てられているリソース・グループ内。 {{site.data.keyword.cfee_full_notm}} サービス内の管理者またはエディターの役割を持つユーザーは、環境を作成および削除できます。 ただし、{{site.data.keyword.cfee_full_notm}} インスタンスにユーザーを割り当てたり、そのインスタンス内のユーザーに割り当てられている役割を変更したりできるのは、管理者役割を持つユーザーのみになります。
   
* **Kubernetes サービス**のリソースに対する_管理者_ の役割。  {{site.data.keyword.cfee_full_notm}} のインスタンスは、Kubernetes サービスによって提供されるコンテナー・クラスター・インフラストラクチャーにデプロイされます。 {{site.data.keyword.cfee_full_notm}} サービスのインスタンスを作成すると、サービスは自動的に Kubernetes クラスターを作成します。 そのクラスター・インフラストラクチャーを作成するためには、Kubernetes サービスに対するアクセス権限が必要です。 Kubernetes サービスに対するアクセス権限ポリシーの適用範囲を、CFEE インスタンスをプロビジョンする予定の特定の地域に限定することも、すべての地域にアクセス権限を適用することもできます。

* CFEE サービスの必須の依存関係である **IBM Cloud オブジェクト・ストレージ・サービス**に対する_管理者_ または_エディター_ のプラットフォーム役割、およびマネージャー・サービスのアクセス役割。  IBM Cloud オブジェクト・ストレージ・サービスのインスタンスは、ICFEE アプリケーション・コンテナーの作成中に生成されるデータ (例えば、アップロードされたアプリケーション・パッケージ、ビルドパック、およびコンパイルされた実行可能プログラムなど) を保管するために使用されます。

* Compose for PostgreSQL サービスのインスタンスは、CFEE サービスの必須の依存関係です。  Compose for PostgreSQL は、Cloud Foundry データ (例えば、アプリケーション・デプロイメント (開始イベントと停止イベント) の監査、CFEE ユーザー・メンバーシップ、組織、スペース、アプリケーション、およびサービス接続の記録) を CFEE インスタンスに保管するために使用されます。  **Compose for PostgreSQL サービス**のそのインスタンスは、{{site.data.keyword.cfee_full_notm}} インスタンスの作成時に選択する、パブリック Cloud Foundry 組織 (CFEE 組織とは無関係) 内のスペースにデプロイされます。  これは、{{site.data.keyword.cfee_full_notm}} インスタンスを作成するときに、CFEE インスタンスをプロビジョンしようとしているロケーションの最低でも 1 つの組織に対して_マネージャー_ のアクセス権限を持っている必要があることを意味します。  また、その組織内の少なくとも 1 つのスペースに対する_開発者_ のアクセス権限も必要です。 

  CFEE インスタンスを作成する予定のロケーション内のどのパブリック組織のメンバーでもない場合、自身をいずれかの組織に招待してもらうよう IBM Cloud 管理者に依頼してください。 アカウント内で管理者の役割をお持ちの場合は、以下を実行することによって、アカウント内のパブリック組織およびスペースにユーザーを追加できます。

     * [**「管理」 > 「アカウント」 > 「Cloud Foundry の組織」**](https://console.bluemix.net/account/organizations)と進み、**「組織の追加」**をクリックするか、既存の組織を選択します。
     * 組織のページの上部にある**「ユーザー」**タブに移動します。
     * CFEE インスタンスを作成する必要があるユーザーを見つけます。 CFEE インスタンスを作成できるようにしたいユーザーがリストに含まれていない場合は、表の上の**「ユーザーの追加または招待」**をクリックして、ユーザーを組織に追加または招待します。
     * 組織のページの上部にある**「スペース」**タブに移動します。
     * Compose for PostgreSQL サービスのインスタンスがプロビジョンされるスペースを見つけて、**「開発者」**役割のチェック・ボックスにチェック・マークを付けます。

以下の画面は、ユーザーが {{site.data.keyword.cfee_full_notm}} インスタンスを作成することを許可する、{{site.data.keyword.Bluemix_notm}} の「ID およびアクセス」ページに表示されるアクセス・ポリシーを示しています。

![アクセス・ポリシー](img/AccessPolicies_Creator.png)

{{site.data.keyword.Bluemix}} のコマンド・ラインを使用して、ユーザー許可を付与できます。  ポリシーを作成するコマンドから呼び出される JSON 形式のファイルにポリシーのパラメーター (つまり、サービス、役割、地域など) を指定して、ユーザーのアクセス・ポリシーを定義することもできます。  詳しくは、[コマンド・ラインを使用した IAM ポリシーのユーザーへの割り当て](https://console.bluemix.net/docs/services/cloud-monitoring/security/assign_policy.html#assign_policy_commandline)を参照するか、またはコマンド・ラインで `ibmcloud iam -help` を実行してください。 これには、[IBM Cloud CLI](https://console.bluemix.net/docs/cli/reference/ibmcloud/download_cli.html#install_use) のインストールが必要であることに注意してください。
{:tip}

{{site.data.keyword.cfee_full_notm}} インスタンスを作成するために必要なアクセス・ポリシーがあることを確認するには、以下のようにします。
1. {{site.data.keyword.Bluemix_notm}} ヘッダーで[**「管理」>「アクセス (IAM)」>「ユーザー」**](https://console.bluemix.net/iam/#/users)メニューに移動して、**「ID およびアクセス」**ページを開きます。
2. 「アクセス・ポリシー」タブで、環境を作成するユーザーをクリックして、そのユーザーのアクセス・ポリシーの割り当ておよび表示を行います。

ユーザーとサービス ID のセットを編成して複数のユーザーに簡単に一括でアクセス権限を割り当てられるようにする方法など、{{site.data.keyword.Bluemix}} でユーザーとアクセス権限を管理する方法について詳しくは、[ユーザーおよびアクセス権限の管理](https://console.bluemix.net/docs/iam/iamusermanage.html#iamusermanage)を参照してください。

### CLI を使用して環境を作成するための許可設定の効率を向上させる
{: #permcli-creating}

`ibmcloud cfee create-permission-set` を使用すると、CFEE インスタンスを作成するための許可の設定を効率良く行うことができます。  このコマンドを使用すれば、CFEE 管理者は、CFEE インスタンスとそのすべての補助サービスを作成するために必要なアクセス・ポリシーを、1 つのコマンドでセットアップできます。 

このコマンドは、IAM _アクセス・グループ_ に許可を設定し、その_アクセス・グループ_ にユーザーを追加します。  このコマンドを実行する管理者は、このコマンドに既存の_アクセス・グループ_ を指定できます。  _アクセス・グループ_ を指定しない場合は、デフォルトの _cfee-provision-access-group_ が自動的に作成されます。

```
ibmcloud cfee create-permission-set USER_NAME [-ag, --access-group GROUP_NAME] [--output TYPE]
```
{: pre}

このコマンドは、ターゲット・ユーザーに次のアクセス・ポリシーを設定します。

*  現在の IBM Cloud アカウントのクラウド・オブジェクト・ストレージ・サービスと CFEE サービスに対するエディターの役割。
*  現在の IBM Cloud アカウントの Kubernetes サービスに対する管理者の役割。
*  Compose for PostgreSQL をプロビジョニングするための現行組織内の現行スペースに対する開発者の役割。

このコマンドについて詳しくは、次のコマンドを実行してください。

```
cfee create-permission-set -help
```
{: pre}

`ibmcloud cfee create-permission-get` を使用して、アクセス・ポリシーがユーザーに適用されていることを確認したり検証したりできます。

```
ibmcloud cfee provision-permission-get USER_NAME [-ag, --access-group GROUP_NAME] [--output TYPE]
```
{: pre}

## 環境の処理を行うために必要な許可
{: #perm-working}

{{site.data.keyword.cfee_full_notm}} のインスタンスの処理を行う場合、ユーザーには以下の条件があります。
1. {{site.data.keyword.cfee_full_notm}} インスタンスが作成された {{site.data.keyword.Bluemix_notm}} アカウントのメンバーでなければならない。
2. アカウント管理者によって以下の IAM _アクセス・ポリシー_ が付与されていなければならない ({{site.data.keyword.Bluemix_notm}} ヘッダーの[**「管理」>「アクセス (IAM)」>「ユーザー」**](https://console.bluemix.net/iam/#/users)メニューの下の_「ID およびアクセス」_ページを参照して、現行アカウントのアクセス・ポリシーを確認してください)。

    CFEE インスタンスで作業しているユーザーは、以下に対する_ビューアー_ 以上のプラットフォーム役割が必要です。
  - CFEE インスタンスが作成されたリソース・グループ。
  - CFEE インスタンスそのもの。 
  
   CFEE インスタンスでのユーザーのアクセスと制御のレベルは、以下のように、アクセス・ポリシーで付与された役割によって決まります。

  - CFEE インスタンスに対して_ビューアー_ の役割を持つユーザーは、メインの {{site.data.keyword.Bluemix_notm}} ダッシュボードにそのインスタンスが表示されるので、そのユーザー・インターフェースを開くことができます。 環境内の特定の組織およびスペースへのユーザー・アクセス権限は、それらの組織およびスペースの管理者によって割り当てられる特定の組織およびスペースの役割で管理されます。 詳しくは、[組織へのユーザーの追加](add-users.html)を参照してください。
  
  - CFEE インスタンスに対する_管理者_ または_エディター_ の役割を割り当てられたユーザーは、組織を作成し、組織とスペースに管理者を割り当て、環境内のすべての組織とスペースに対して完全な許可を持ち、Cloud Controller API を使用して操作アクションを実行することができます。 これらのユーザーには、Cloud Foundry の_「ユーザー・アカウントおよび認証スコープ」_で _cloud_controller.admin scope_ が自動的に付与されます。

  - **CFEE を新規バージョンに更新**するには、CFEE インスタンスに対する_エディター_ 以上のプラットフォーム役割と、CFEE がプロビジョンされる Kubernetes クラスターに対する_オペレーター_ 以上の役割が必要です。

  - CFEE の**容量を変更** (セルを追加または削除) するには、CFEE インスタンスに対する_管理者_ のプラットフォーム役割と、CFEE がプロビジョンされる Kubernetes クラスターに対する_オペレーター_ 以上の役割が必要です。
 
  - CFEE スペースに IBM Cloud *サービス・インスタンス* を**追加**できるようにする (つまり、CFEE スペースにサービス・インスタンスの別名を作成する) には、そのサービス・インスタンスに対する_オペレーター_ 以上のプラットフォーム役割が必要です。
 
  - CFEE スペースにデプロイされたアプリケーションに IBM Cloud サービス・インスタンスを**バインド**できるようにするには、そのサービス・インスタンスに対する_オペレーター_ 以上のプラットフォーム役割と、_ライター_ 以上のサービス役割が必要です。


## ベスト・プラクティス: アクセス・グループ
{: #access-groups}

ご使用の CFEE のアクセス制御を管理し、単純化するために、アクセス・グループを使用することを検討してください。  アクセス・グループを使用すると、アクセス・ポリシーを割り当てることができる任意のグループを定義できるようになります。  アクセス・グループに追加されたユーザーには、そのグループのアクセス・ポリシーが自動的に割り当てられます。 

アクセス・グループは、IBM Cloud ユーザー・インターフェースまたは `ibmcloud` cli を介して作成および管理できます。 

ユーザー・インターフェースからメニュー・バーに移動して、**「管理」>「アクセス (IAM)」**をクリックし、[アクセス・グループ](https://cloud.ibm.com/iam#/groups)を選択します。

あるいは、`ibmcloud` cli を使用することもできます。

1. アクセス・グループを作成します。

  ```
  ibmcloud iam access-group-create GROUP_NAME [-d, --description DESCRIPTION]
```
  {: pre}

2. そのアクセス・グループのアクセス・ポリシーを作成します。

  ```
  ibmcloud iam access-group-policy-create GROUP_NAME
  ```
  {: pre}

3. アクセス・グループにユーザーを追加します。

  ```
  ibmcloud iam access-group-user-add <user-name> [<user-name2...]
  ```
  {: pre}

<br>
詳しくは、[アクセス・グループのセットアップ](https://cloud.ibm.com/docs/iam/groups.html#groups) を参照してください。
