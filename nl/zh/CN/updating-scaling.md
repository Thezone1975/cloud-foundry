---

copyright:

  years: 2018
lastupdated: "2019-01-31"

---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}
{:codeblock: .codeblock}
{:pre: .pre}
{:screen: .screen}
{:tip: .tip}

# 更新和扩展
{: #update-scale}

将 {{site.data.keyword.cfee_full_notm}} 服务实例更新为最新版本可获取最新的 CFEE 功能和修订。CFEE 的更新可能包括 Cloud Foundry 的新版本和 CFEE 支持服务（Kubernetes、Cloud Object Storage 或 Compose for PostgreSQL）。但是，并非每个 CFEE 更新都包含 Cloud Foundry 的新版本和 CFEE 支持服务。

CFEE 版本更新在包含 CFEE 组件的控制平面上以及单元上执行。您还可以通过添加或删除应用程序单元来扩展 CFEE 实例的容量。

**注：**在更新版本期间，或者在添加或删除单元时，_概述_、_资源使用情况_以及_更新和扩展_页面中显示的某些度量值（例如，内存和 CPU）可能不可用。

## 更新 CFEE 版本
{: #update}

用户需要具备以下许可权才能将 CFEE 实例更新为新版本：
   * 针对 CFEE 实例的_编辑者_角色或更高角色。
   * 针对在其中供应 CFEE 的 Kubernetes 集群的_操作员_角色或更高角色。

更新 CFEE 实例的 CFEE 版本的过程分为两个步骤。首先，更新用于托管 CFEE 组件的控制平面。然后，更新用于托管应用程序的单元。

将 CFEE 更新为新版本时，以下规则和约束适用：
* 必须先更新控制平面。更新了控制平面后，即可以更新单元。
* 应用程序单元只能更新为控制平面的版本。即，控制平面的 CFEE 版本级别可以高于应用程序单元，但反之不成立。

要更新 CFEE 实例的 CFEE 版本，请执行以下操作：
1. 转至 [{{site.data.keyword.Bluemix_notm}} 仪表板](https://cloud.ibm.com/dashboard/apps/)，然后打开要更新的 {{site.data.keyword.cfee_full_notm}}。
2. 转至导航窗格中_操作_条目下的**更新和缩放**页面。
3. （可选）在_控制平面_表中，可以展开相应行以查看控制平面中的工作程序节点。
4. 单击**更新**。
5. 在“更新_控制平面_”对话框中，选择其中一个可用的 CFEE 版本，然后单击**更新**。更新大约需要 45 分钟。版本描述中详细描述了所选 CFEE 版本包内包含的组件的版本，以及用于描述该版本中所交付内容的_新增内容_文档的链接。
6. _节点状态_列显示更新的进度。更新完成后，_版本_列将反映出新的 CFEE 版本。
7. 完成了对控制平面单元的更新后，请找到_单元_表，然后单击**更新**。
8. 在_更新控制平面_对话框中，选择 CFEE 版本，然后单击*更新*。由于单元只能更新为控制平面的版本，因此只有可供单元更新的可用版本。一个更新操作就可更新所有单元。
9. 单元会按顺序更新。_节点状态_列指示每个单元的更新进度。更新单元后，其新版本会反映在_版本_列中。

## 版本更新期间的中断
{: #update-disruption}

更新 Cloud Foundry 控制平面不会发生中断。但是，将 Cloud Foundry 单元更新为新的 CFEE 版本时，可能会中断 CFEE 环境的操作。一次只更新一个单元，因此在一个单元中运行的应用程序实例在更新完成后会重新启动，而其他单元的更新在该单元更新期间会停止运行。但是，在某些情况下，在 CFEE 中运行的某些应用程序和服务可能会变得不可用。例如，如果 CFEE 最多具有两个 Cloud Foundry 单元，那么只有一个实例的应用程序将在版本更新期间停止运行，因为该应用程序实例无法在更新单元时移至另一个单元，因此，该应用程序将不可用。即使有三个单元并且每个应用程序有三个实例，在版本更新期间也可能会发生应用程序可用性短暂中断的情况。

在版本更新期间，CFEE _概述_页面中显示的“单元节点”标尺中报告的内存和 CPU 度量值（由 Kubernetes 集群生成）与 Grafana 中_节点_仪表板中显示的内存和 CPU 度量值（在操作系统级别生成）可能不一致。

正在更新期间，CFEE 组件的状态将反映在“运行状况检查”页面中。重新启动大约需要 45 分钟。

## 版本周期和支持策略
{: #version-cycle}

Cloud Foundry Enterprise Environment 服务通常会定期发布新版本。服务的版本遵循语义版本控制格式：_**主版本.次版本.补丁**_ (https://semver.org/)。

_次_版本定期递增（通常为每月一次）。_主_版本也会递增，但递增频率低于次版本，通常在有重大更改的情况下才会递增。更新为_主_版本可能导致升级期间发生一些中断。_补丁_交付的是修订，并应用于最新可用版本。 

为了防止系统停机，只允许将 CFEE 实例更新到比当前版本高最多 2 个_主_版本的版本。对于先前的示例，如果 CFEE 实例当前版本为 3.1.2，目标版本为 7.0.0，那么需要先将 CFEE 实例更新为 V5.x.x，然后再更新为目标版本 V7.0.0。

定期交付的新功能以及现有功能的增强功能仅在最新版本中可用。关键修订仅在最新的 3 个_主_版本（最新版本和前两个版本）内的最新发行版中交付。例如，如果 V4.x.x、V3.x.x 和 V2.x.x 可用，那么将不支持 V1.x.x（即，补丁不会随 V1.x.x 的修订一起交付）。  

补丁在给定_主版本_的最新可用版本上交付。例如，如果 CFEE 实例运行的是 V3.1.2，但 3.x.x _主版本_中的最新可用版本是 V3.3.4，那么任何补丁都将在 V3.3.x 的代码库上交付，这意味着补丁将在（新的）V3.3.5 中交付。V3.1.2 的 CFEE 实例需要更新到 V3.3.5 才能接收新补丁（即，仅更新为 V3.3.4 不会解决补丁中修订的问题，补丁仅在 V3.3.5 中提供）。

## 扩展 CFEE 基础架构
{: #scale}

用户需要以下许可权才能向 CFEE 实例添加 Cloud Foundry 单元或从 CFEE 实例中除去 Cloud Foundry 单元：
* 针对 CFEE 实例的_管理员_角色或更高角色。
* 针对在其中供应 CFEE 的 Kubernetes 集群的_操作员_角色或更高角色。

要向 CFEE 实例添加应用程序单元，请执行以下操作：
1. 转至 [{{site.data.keyword.Bluemix_notm}} 仪表板](https://cloud.ibm.com/dashboard/apps/)，然后打开要在其中添加单元的 {{site.data.keyword.cfee_full_notm}}。
2. 单击_单元_表附近的**更改 Cloud Foundry 单元计数**，这将打开_添加 Cloud Foundry 单元_页面。
3. 在_更改 Cloud Foundry 单元计数_页面中，选择“目标单元计数”字段中的单元总数。该页面还会显示将添加单元的 CFEE 实例的地理位置和位置。它还在_当前单元计数_字段中显示当前单元数，并在“节点大小”字段中显示要添加的单元的容量（与当前单元的容量相同）。该页面的右侧窗格将显示要添加的单元的估算成本以及环境的新的总估算成本。
4. 单击**添加单元**。在_添加单元_对话框中，单击**添加**
5. 返回到_更新和缩放_页面。在_单元节点_表中，将为每个新单元节点添加一个新行。“节点状态”列指示将单元添加和部署到 CFEE 环境的进度。
